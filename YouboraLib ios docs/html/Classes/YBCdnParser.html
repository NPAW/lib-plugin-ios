<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">

	<title>YBCdnParser Class Reference</title>

	<link rel="stylesheet" href="../css/style.css">
	<meta name="viewport" content="initial-scale=1, maximum-scale=1.4">
	<meta name="generator" content="appledoc 2.2.1 (build 1334)">
</head>
<body class="appledoc">
	<header>
		<div class="container" class="hide-in-xcode">
			
			<h1 id="library-title">
				<a href="../index.html">YouboraLib </a>
			</h1>

			<p id="developer-home">
				<a href="../index.html">Nice People At Work</a>
			</p>
			
		</div>
	</header>

	<aside>
		<div class="container">
			<nav>
				<ul id="header-buttons" role="toolbar">
					<li><a href="../index.html">Index</a></li>
<li><a href="../hierarchy.html">Hierarchy</a></li>

					<li id="on-this-page" role="navigation">
						<label>
							On This Page

							<div class="chevron">
								<div class="chevy chevron-left"></div>
								<div class="chevy chevron-right"></div>
							</div>

							<select id="jump-to">
	<option value="top">Jump To&#133;</option>
	
	<option value="overview">Overview</option>
	

	
	
	<option value="tasks">Tasks</option>
	
	

	
	
	<optgroup label="Properties">
		
		<option value="//api/name/cdnName">cdnName</option>
		
		<option value="//api/name/cdnNodeHost">cdnNodeHost</option>
		
		<option value="//api/name/cdnNodeType">cdnNodeType</option>
		
		<option value="//api/name/cdnNodeTypeString">cdnNodeTypeString</option>
		
		<option value="//api/name/responses">responses</option>
		
	</optgroup>
	

	
	<optgroup label="Class Methods">
		
		<option value="//api/name/addCdn:withConfig:">+ addCdn:withConfig:</option>
		
		<option value="//api/name/createWithName:">+ createWithName:</option>
		
		<option value="//api/name/definedCdns">+ definedCdns</option>
		
		<option value="//api/name/setBalancerHeaderName:">+ setBalancerHeaderName:</option>
		
	</optgroup>
	

	
	<optgroup label="Instance Methods">
		
		<option value="//api/name/addCdnTransformDelegate:">- addCdnTransformDelegate:</option>
		
		<option value="//api/name/initWithCdnConfig:">- initWithCdnConfig:</option>
		
		<option value="//api/name/parseWithUrl:andPreviousResponses:">- parseWithUrl:andPreviousResponses:</option>
		
		<option value="//api/name/removeCdnTransformDelegate:">- removeCdnTransformDelegate:</option>
		
	</optgroup>
	
	
</select>
						</label>
					</li>
				</ul>
			</nav>
		</div>
	</aside>

	<article>
		<div id="overview_contents" class="container">
			<div id="content">
				<main role="main">
					<h1 class="title">YBCdnParser Class Reference</h1>

					
					<div class="section section-specification"><table cellspacing="0"><tbody>
						<tr>
	<th>Inherits from</th>
	<td>NSObject</td>
</tr><tr>
	<th>Declared in</th>
	<td>YBCdnParser.h<br />YBCdnParser.m</td>
</tr>
						</tbody></table></div>
					

                    
					
					<div class="section section-overview">
						<a title="Overview" name="overview"></a>
						<h2 class="subtitle subtitle-overview">Overview</h2>
						<p>Class that asynchronously tries to get information about the CDN where a given resource is
hosted.
The info we care about is the CDN code itself, the node host and node type.</p>

<p>The CDN is queried with http HEAD requests. This only will work if the customer has properly
configured their CDN.</p>

<p>When HEAD requests are performed against the resources, the CDN returns a set of headers that
containing info about the cdn header and / or cdn type.</p>

<p>Each CDN is different; some require special headers to be set when the HEAD request is performed
and others don&rsquo;t. Also, the info can come back in any fashion of ways, sometimes both type and host
come in the same response header while sometimes they&rsquo;re in different headers. The format of these
response headers is also different from CDN to CDN, so a different regex is used for each CDN.</p>

<p>Lastly, as the values indicating the CDN type are also different, we need a specific mapping for
each one.</p>

<p>This is the process to add a new CDN to the parser.</p>

<ol>
<li>CDN code. The class that holds all the needed info is YBCdnConfig. It should be
constructed passing the CDN code that represents this CDN. This is a YOUBORA code and can
be found <a href="http://mapi.youbora.com:8081/cdns">here</a>.</li>
<li>Response headers. The CDN will answer the HEAD request with headers that contain the
info we're looking for. We should add as many YBParsableResponseHeader as needed.
The constructor needs three things:
<ul>
<li>Element. Specify if this header will contain the Host, Type, or both. Note that HostAndType
is not the same as TypeAndHost.
The order is the same as how will they will appear in the header response value. This can
also have the "Name" value, indicating that this field value is actually the CDN name</li>
<li>Header response name. Header from where the info will be got from.</li>
<li>Regex. Regular expression to extract host and/or type. If only one of them is expected
define one capturing group, and two otherwise.</li>
</ul>
</li>
<li>Request headers. Add headers to YBCdnConfig's requestHeaders if this CDN
requires special headers to be set in order to respond with the info we want.</li>
<li>Type parser. Once the CDN Type value is found (using one of the previously set
YBParsableResponseHeader) this parser will be called passing it the found value
as a String. This parser should return Hit or Miss depending on the Type string parameter.
If it doesn't match with what would you expect,
return Unknown instead.</li>
</ol>

					</div>
					
					

					
					
					<div class="section section-tasks">
						<a title="Tasks" name="tasks"></a>
						

						<a title="Public properties" name="task_Public properties"></a>
						<h2 class="task-title">Public properties</h2>

						<div class="task-list">
							<div class="section-method">
	<a name="//api/name/responses" title="responses"></a>
	<h3 class="method-title"><code><a href="#//api/name/responses">&nbsp;&nbsp;responses</a></code>
</h3>

	<div class="method-info">
		<div class="pointy-thing"></div>

		<div class="method-info-container">
			
			
			<div class="method-subsection brief-description">
				<p>The request responses from this CdnParser.</p>
			</div>
			
		    

			<div class="method-subsection method-declaration"><code>@property (nonatomic, strong, readonly) NSMutableDictionary *responses</code></div>

		    
			

			

			

			
			<div class="method-subsection discussion-section">
				<h4 class="method-subtitle">Discussion</h4>
				<p>The request responses from this CdnParser.</p>

<p>This is filled with the responses from the constructor, or created empty if nil.
Then the performed request response (if any) is added to this map.
Call this method after &ldquo;using&rdquo; the CdnParser and pass the responses to the following
CdnParser so it can use the responses if it applies.</p>
			</div>
			

			

			

			
			<div class="method-subsection declared-in-section">
				<h4 class="method-subtitle">Declared In</h4>
				<p><code class="declared-in-ref">YBCdnParser.h</code></p>
			</div>
			
			
		</div>
	</div>
</div><div class="section-method">
	<a name="//api/name/cdnNodeHost" title="cdnNodeHost"></a>
	<h3 class="method-title"><code><a href="#//api/name/cdnNodeHost">&nbsp;&nbsp;cdnNodeHost</a></code>
</h3>

	<div class="method-info">
		<div class="pointy-thing"></div>

		<div class="method-info-container">
			
			
			<div class="method-subsection brief-description">
				<p>Cdn node host</p>
			</div>
			
		    

			<div class="method-subsection method-declaration"><code>@property (nonatomic, strong, readonly) NSString *cdnNodeHost</code></div>

		    
			

			

			

			
			<div class="method-subsection discussion-section">
				<h4 class="method-subtitle">Discussion</h4>
				<p>Cdn node host</p>
			</div>
			

			

			

			
			<div class="method-subsection declared-in-section">
				<h4 class="method-subtitle">Declared In</h4>
				<p><code class="declared-in-ref">YBCdnParser.h</code></p>
			</div>
			
			
		</div>
	</div>
</div><div class="section-method">
	<a name="//api/name/cdnNodeType" title="cdnNodeType"></a>
	<h3 class="method-title"><code><a href="#//api/name/cdnNodeType">&nbsp;&nbsp;cdnNodeType</a></code>
</h3>

	<div class="method-info">
		<div class="pointy-thing"></div>

		<div class="method-info-container">
			
			
			<div class="method-subsection brief-description">
				<p>Cdn node type as raw value parsed from the header response</p>
			</div>
			
		    

			<div class="method-subsection method-declaration"><code>@property (nonatomic, assign, readonly) YBCdnType cdnNodeType</code></div>

		    
			

			

			

			
			<div class="method-subsection discussion-section">
				<h4 class="method-subtitle">Discussion</h4>
				<p>Cdn node type as raw value parsed from the header response</p>
			</div>
			

			

			

			
			<div class="method-subsection declared-in-section">
				<h4 class="method-subtitle">Declared In</h4>
				<p><code class="declared-in-ref">YBCdnParser.h</code></p>
			</div>
			
			
		</div>
	</div>
</div><div class="section-method">
	<a name="//api/name/cdnNodeTypeString" title="cdnNodeTypeString"></a>
	<h3 class="method-title"><code><a href="#//api/name/cdnNodeTypeString">&nbsp;&nbsp;cdnNodeTypeString</a></code>
</h3>

	<div class="method-info">
		<div class="pointy-thing"></div>

		<div class="method-info-container">
			
			
			<div class="method-subsection brief-description">
				<p>Parsed node type as returned by a YBCdnTypeParserBlock (YBCdnConfig)</p>
			</div>
			
		    

			<div class="method-subsection method-declaration"><code>@property (nonatomic, strong, readonly) NSString *cdnNodeTypeString</code></div>

		    
			

			

			

			
			<div class="method-subsection discussion-section">
				<h4 class="method-subtitle">Discussion</h4>
				<p>Parsed node type as returned by a YBCdnTypeParserBlock (YBCdnConfig)</p>
			</div>
			

			

			

			
			<div class="method-subsection declared-in-section">
				<h4 class="method-subtitle">Declared In</h4>
				<p><code class="declared-in-ref">YBCdnParser.h</code></p>
			</div>
			
			
		</div>
	</div>
</div><div class="section-method">
	<a name="//api/name/cdnName" title="cdnName"></a>
	<h3 class="method-title"><code><a href="#//api/name/cdnName">&nbsp;&nbsp;cdnName</a></code>
</h3>

	<div class="method-info">
		<div class="pointy-thing"></div>

		<div class="method-info-container">
			
			
			<div class="method-subsection brief-description">
				<p>The Cdn name. This will be the code specified in the YBCdnConfig initialiser
unless YBCdnHeaderElementName is specified in a YBParsableResponseHeader and a match is found.</p>
			</div>
			
		    

			<div class="method-subsection method-declaration"><code>@property (nonatomic, strong, readonly) NSString *cdnName</code></div>

		    
			

			

			

			
			<div class="method-subsection discussion-section">
				<h4 class="method-subtitle">Discussion</h4>
				<p>The Cdn name. This will be the code specified in the YBCdnConfig initialiser
unless YBCdnHeaderElementName is specified in a YBParsableResponseHeader and a match is found.</p>
			</div>
			

			

			

			
			<div class="method-subsection declared-in-section">
				<h4 class="method-subtitle">Declared In</h4>
				<p><code class="declared-in-ref">YBCdnParser.h</code></p>
			</div>
			
			
		</div>
	</div>
</div>
						</div>
						

						<a title="Init" name="task_Init"></a>
						<h2 class="task-title">Init</h2>

						<div class="task-list">
							<div class="section-method">
	<a name="//api/name/initWithCdnConfig:" title="initWithCdnConfig:"></a>
	<h3 class="method-title"><code><a href="#//api/name/initWithCdnConfig:">&ndash;&nbsp;initWithCdnConfig:</a></code>
</h3>

	<div class="method-info">
		<div class="pointy-thing"></div>

		<div class="method-info-container">
			
			
			<div class="method-subsection brief-description">
				<p>Initialises the CdnParser with a YBCdnConfig</p>
			</div>
			
		    

			<div class="method-subsection method-declaration"><code>- (instancetype)initWithCdnConfig:(YBCdnConfig *)<em>cdnConfig</em></code></div>

		    
			
			<div class="method-subsection arguments-section parameters">
				<h4 class="method-subtitle parameter-title">Parameters</h4>
				<table class="argument-def parameter-def">
				
					<tr>
						<th scope="row" class="argument-name"><code>cdnConfig</code></th>
						<td><p>the cdn config to use with this parser</p></td>
					</tr>
				
				</table>
			</div>
			

			

			

			
			<div class="method-subsection discussion-section">
				<h4 class="method-subtitle">Discussion</h4>
				<p>Initialises the CdnParser with a YBCdnConfig</p>
			</div>
			

			

			

			
			<div class="method-subsection declared-in-section">
				<h4 class="method-subtitle">Declared In</h4>
				<p><code class="declared-in-ref">YBCdnParser.h</code></p>
			</div>
			
			
		</div>
	</div>
</div>
						</div>
						

						<a title="Public methods" name="task_Public methods"></a>
						<h2 class="task-title">Public methods</h2>

						<div class="task-list">
							<div class="section-method">
	<a name="//api/name/parseWithUrl:andPreviousResponses:" title="parseWithUrl:andPreviousResponses:"></a>
	<h3 class="method-title"><code><a href="#//api/name/parseWithUrl:andPreviousResponses:">&ndash;&nbsp;parseWithUrl:andPreviousResponses:</a></code>
</h3>

	<div class="method-info">
		<div class="pointy-thing"></div>

		<div class="method-info-container">
			
			
			<div class="method-subsection brief-description">
				<p>Start parsing the CDN for the given resource.</p>
			</div>
			
		    

			<div class="method-subsection method-declaration"><code>- (void)parseWithUrl:(NSString *)<em>url</em> andPreviousResponses:(nullable NSDictionary *)<em>responses</em></code></div>

		    
			
			<div class="method-subsection arguments-section parameters">
				<h4 class="method-subtitle parameter-title">Parameters</h4>
				<table class="argument-def parameter-def">
				
					<tr>
						<th scope="row" class="argument-name"><code>url</code></th>
						<td><p>the resource url to parse the CDN</p></td>
					</tr>
				
					<tr>
						<th scope="row" class="argument-name"><code>responses</code></th>
						<td><p>previous http responses that may be re-used so we can avoid making them again</p></td>
					</tr>
				
				</table>
			</div>
			

			

			

			
			<div class="method-subsection discussion-section">
				<h4 class="method-subtitle">Discussion</h4>
				<p>Start parsing the CDN for the given resource.</p>
			</div>
			

			

			

			
			<div class="method-subsection declared-in-section">
				<h4 class="method-subtitle">Declared In</h4>
				<p><code class="declared-in-ref">YBCdnParser.h</code></p>
			</div>
			
			
		</div>
	</div>
</div><div class="section-method">
	<a name="//api/name/addCdnTransformDelegate:" title="addCdnTransformDelegate:"></a>
	<h3 class="method-title"><code><a href="#//api/name/addCdnTransformDelegate:">&ndash;&nbsp;addCdnTransformDelegate:</a></code>
</h3>

	<div class="method-info">
		<div class="pointy-thing"></div>

		<div class="method-info-container">
			
			
			<div class="method-subsection brief-description">
				<p>Add a delegate that will be notified whenever this CdnParser finishes.</p>
			</div>
			
		    

			<div class="method-subsection method-declaration"><code>- (void)addCdnTransformDelegate:(id&lt;CdnTransformDoneDelegate&gt;)<em>delegate</em></code></div>

		    
			
			<div class="method-subsection arguments-section parameters">
				<h4 class="method-subtitle parameter-title">Parameters</h4>
				<table class="argument-def parameter-def">
				
					<tr>
						<th scope="row" class="argument-name"><code>delegate</code></th>
						<td><p>the delegate to add.</p></td>
					</tr>
				
				</table>
			</div>
			

			

			

			
			<div class="method-subsection discussion-section">
				<h4 class="method-subtitle">Discussion</h4>
				<p>Add a delegate that will be notified whenever this CdnParser finishes.</p>
			</div>
			

			

			

			
			<div class="method-subsection declared-in-section">
				<h4 class="method-subtitle">Declared In</h4>
				<p><code class="declared-in-ref">YBCdnParser.h</code></p>
			</div>
			
			
		</div>
	</div>
</div><div class="section-method">
	<a name="//api/name/removeCdnTransformDelegate:" title="removeCdnTransformDelegate:"></a>
	<h3 class="method-title"><code><a href="#//api/name/removeCdnTransformDelegate:">&ndash;&nbsp;removeCdnTransformDelegate:</a></code>
</h3>

	<div class="method-info">
		<div class="pointy-thing"></div>

		<div class="method-info-container">
			
			
			<div class="method-subsection brief-description">
				<p>Removes a delegate</p>
			</div>
			
		    

			<div class="method-subsection method-declaration"><code>- (void)removeCdnTransformDelegate:(id&lt;CdnTransformDoneDelegate&gt;)<em>delegate</em></code></div>

		    
			
			<div class="method-subsection arguments-section parameters">
				<h4 class="method-subtitle parameter-title">Parameters</h4>
				<table class="argument-def parameter-def">
				
					<tr>
						<th scope="row" class="argument-name"><code>delegate</code></th>
						<td><p>the delegate to remove</p></td>
					</tr>
				
				</table>
			</div>
			

			

			

			
			<div class="method-subsection discussion-section">
				<h4 class="method-subtitle">Discussion</h4>
				<p>Removes a delegate</p>
			</div>
			

			

			

			
			<div class="method-subsection declared-in-section">
				<h4 class="method-subtitle">Declared In</h4>
				<p><code class="declared-in-ref">YBCdnParser.h</code></p>
			</div>
			
			
		</div>
	</div>
</div>
						</div>
						

						<a title="Static methods" name="task_Static methods"></a>
						<h2 class="task-title">Static methods</h2>

						<div class="task-list">
							<div class="section-method">
	<a name="//api/name/setBalancerHeaderName:" title="setBalancerHeaderName:"></a>
	<h3 class="method-title"><code><a href="#//api/name/setBalancerHeaderName:">+&nbsp;setBalancerHeaderName:</a></code>
</h3>

	<div class="method-info">
		<div class="pointy-thing"></div>

		<div class="method-info-container">
			
			
			<div class="method-subsection brief-description">
				<p>This is a special case. A custom CDN definition
that tries to get the CDN name directly from one of the headers. This method can be used
as a shortcut to creating a new CDN definition.
This is usually used with DNS-based load balance services, such as Cedexis.</p>
			</div>
			
		    

			<div class="method-subsection method-declaration"><code>+ (void)setBalancerHeaderName:(NSString *)<em>cdnNameHeader</em></code></div>

		    
			
			<div class="method-subsection arguments-section parameters">
				<h4 class="method-subtitle parameter-title">Parameters</h4>
				<table class="argument-def parameter-def">
				
					<tr>
						<th scope="row" class="argument-name"><code>cdnNameHeader</code></th>
						<td><p>the header response name where to get the CDN name from.</p></td>
					</tr>
				
				</table>
			</div>
			

			

			

			
			<div class="method-subsection discussion-section">
				<h4 class="method-subtitle">Discussion</h4>
				<p>This is a special case. A custom CDN definition
that tries to get the CDN name directly from one of the headers. This method can be used
as a shortcut to creating a new CDN definition.
This is usually used with DNS-based load balance services, such as Cedexis.</p>
			</div>
			

			

			

			
			<div class="method-subsection declared-in-section">
				<h4 class="method-subtitle">Declared In</h4>
				<p><code class="declared-in-ref">YBCdnParser.h</code></p>
			</div>
			
			
		</div>
	</div>
</div><div class="section-method">
	<a name="//api/name/createWithName:" title="createWithName:"></a>
	<h3 class="method-title"><code><a href="#//api/name/createWithName:">+&nbsp;createWithName:</a></code>
</h3>

	<div class="method-info">
		<div class="pointy-thing"></div>

		<div class="method-info-container">
			
			
			<div class="method-subsection brief-description">
				<p>Create one of the pre-defined CDN definitions.</p>
			</div>
			
		    

			<div class="method-subsection method-declaration"><code>+ (nullable YBCdnParser *)createWithName:(NSString *)<em>cdnName</em></code></div>

		    
			
			<div class="method-subsection arguments-section parameters">
				<h4 class="method-subtitle parameter-title">Parameters</h4>
				<table class="argument-def parameter-def">
				
					<tr>
						<th scope="row" class="argument-name"><code>cdnName</code></th>
						<td><p>Name of the CDN</p></td>
					</tr>
				
				</table>
			</div>
			

			
			<div class="method-subsection return">
				<h4 class="method-subtitle parameter-title">Return Value</h4>
				<p>a YBCdnParser instance or nil if the names does not match any CDN</p>
			</div>
			

			

			
			<div class="method-subsection discussion-section">
				<h4 class="method-subtitle">Discussion</h4>
				<p>Create one of the pre-defined CDN definitions.</p>
			</div>
			

			

			

			
			<div class="method-subsection declared-in-section">
				<h4 class="method-subtitle">Declared In</h4>
				<p><code class="declared-in-ref">YBCdnParser.h</code></p>
			</div>
			
			
		</div>
	</div>
</div><div class="section-method">
	<a name="//api/name/addCdn:withConfig:" title="addCdn:withConfig:"></a>
	<h3 class="method-title"><code><a href="#//api/name/addCdn:withConfig:">+&nbsp;addCdn:withConfig:</a></code>
</h3>

	<div class="method-info">
		<div class="pointy-thing"></div>

		<div class="method-info-container">
			
			
			<div class="method-subsection brief-description">
				<p>Adds the given CDN config to the cdn definitions.</p>
			</div>
			
		    

			<div class="method-subsection method-declaration"><code>+ (void)addCdn:(NSString *)<em>cdnName</em> withConfig:(YBCdnConfig *)<em>cdnConfig</em></code></div>

		    
			
			<div class="method-subsection arguments-section parameters">
				<h4 class="method-subtitle parameter-title">Parameters</h4>
				<table class="argument-def parameter-def">
				
					<tr>
						<th scope="row" class="argument-name"><code>cdnName</code></th>
						<td><p>The name that will identify the CDN</p></td>
					</tr>
				
					<tr>
						<th scope="row" class="argument-name"><code>cdnConfig</code></th>
						<td><p>The YBCdnConfig that defines the CDN</p></td>
					</tr>
				
				</table>
			</div>
			

			

			

			
			<div class="method-subsection discussion-section">
				<h4 class="method-subtitle">Discussion</h4>
				<p>Adds the given CDN config to the cdn definitions.</p>
			</div>
			

			

			

			
			<div class="method-subsection declared-in-section">
				<h4 class="method-subtitle">Declared In</h4>
				<p><code class="declared-in-ref">YBCdnParser.h</code></p>
			</div>
			
			
		</div>
	</div>
</div><div class="section-method">
	<a name="//api/name/definedCdns" title="definedCdns"></a>
	<h3 class="method-title"><code><a href="#//api/name/definedCdns">+&nbsp;definedCdns</a></code>
</h3>

	<div class="method-info">
		<div class="pointy-thing"></div>

		<div class="method-info-container">
			
			
			<div class="method-subsection brief-description">
				<p>Returns the current dict of defined cdns</p>
			</div>
			
		    

			<div class="method-subsection method-declaration"><code>+ (NSDictionary&lt;NSString*,YBCdnConfig*&gt; *)definedCdns</code></div>

		    
			

			
			<div class="method-subsection return">
				<h4 class="method-subtitle parameter-title">Return Value</h4>
				<p>the current dict of defined cdns</p>
			</div>
			

			

			
			<div class="method-subsection discussion-section">
				<h4 class="method-subtitle">Discussion</h4>
				<p>Returns the current dict of defined cdns</p>
			</div>
			

			

			

			
			<div class="method-subsection declared-in-section">
				<h4 class="method-subtitle">Declared In</h4>
				<p><code class="declared-in-ref">YBCdnParser.h</code></p>
			</div>
			
			
		</div>
	</div>
</div>
						</div>
						
					</div>
					
					

                    
                    
          
				</main>

				<footer>
					<div class="footer-copyright">
						
						<p class="copyright">Copyright &copy; 2017 Nice People At Work. All rights reserved. Updated: 2017-11-28</p>
						
						
						<p class="generator">Generated by <a href="http://appledoc.gentlebytes.com">appledoc 2.2.1 (build 1334)</a>.</p>
						
					</div>
				</footer>
			</div>
		</div>
	</article>

	<script src="../js/script.js"></script>
</body>
</html>